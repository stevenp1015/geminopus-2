# Gemini Legion Codebase Audit Report

**Date:** 2024-07-26
**Auditor:** Jules (Senior Systems Architect & Code Auditor)

## 1. Objective

Perform a comprehensive audit of the provided codebase (`gemini_legion_backend`, `gemini_legion_frontend`) to verify its adherence to the defined architectural blueprint (`IDEAL_ARCHITECTURE_DESIGN_DOCUMENT.md`), considering context from `critical_handoff_v6` and `critical_handoff_v7` documents.

## 2. Overall Alignment Status

**Partial alignment with known Work-In-Progress (WIP) areas and a critical blocker in core ADK integration.**

The V2 codebase represents a significant improvement over previous iterations (as described in handoff documents) and establishes a foundational structure that is largely in line with the `IDEAL_ARCHITECTURE_DESIGN_DOCUMENT.md` concerning module organization, event-driven principles, and basic ADK agent patterns.

However, many advanced features specified in the ideal architecture are not yet implemented, which appears to be a deliberate deferral to focus on core functionality in the V2 effort. A critical issue persists in the ADK `Runner`'s session management, preventing successful generation of AI responses, which is the primary goal of the V2 stabilization.

## 3. Summary of Key Alignments

The current codebase successfully implements several key aspects of the ideal architecture:

*   **Layered Architecture:** The separation into GUI (frontend), API Gateway (FastAPI), Application Services, Core Domain, and Infrastructure layers is clearly visible and generally well-maintained in both backend and frontend structures.
*   **Event-Driven Architecture:** The backend utilizes a central event bus (`GeminiEventBus`) for inter-service communication and state change notifications. This is bridged to the frontend via WebSockets (`WebSocketEventBridge`) for real-time UI updates, aligning with the specified EDA principles.
*   **Domain-Driven Design (Foundations):** Core domain entities for Minions (`Minion`, `MinionPersona`), Communication (`Channel`, `Message`), and basic Emotional State (`EmotionalState`, `MoodVector`, `OpinionScore`) are defined and structured largely as specified.
*   **ADK Agent Basics:** `ADKMinionAgent` correctly extends `google.adk.agents.LlmAgent`, and the issue of storing custom agent data while respecting Pydantic validation has been resolved using private attributes, as noted in handoff V7. Dynamic instruction building based on persona is also implemented.
*   **API and Service Structure:** V2 API endpoints and corresponding services (`MinionServiceV2`, `ChannelServiceV2`) are established, showing a clean separation of concerns.
*   **Frontend Structure:** The frontend (React/TypeScript with Zustand) generally follows the proposed component and state management structure.

## 4. Detailed Deviations Analysis

The following table lists significant deviations from the `IDEAL_ARCHITECTURE_DESIGN_DOCUMENT.md`, contextualized with information from `critical_handoff_v6` and `critical_handoff_v7`.

| Deviation Category                      | Architecture Requires                                                                                                | Code Implements                                                                                                                               | Handoff Context & Conclusion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           _GOLITE_INTELLIGENCE_CLIENT_API_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Ii01NDQxZDI4Y2Y3YTE3ZTY5ZTU5Y2MyNDZiYCSJ9.eyJlbWFpbCI6ImFudGhvbnkudHJhbnNpdG9yZW50YWNjdEBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiZXhwIjoxNzE5NzgyMDYyLCJpc3MiOiJhY2NvdW50cy5nb29nbGUuY29tIiwibmFtZSI6IkFudGhvbnkgVHJhbnNpdG9yZW50IiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0lUaE9zU1hSOGhRMXFjT2x2VnBFMlpWTDJEaGk3U014R09xZWtHUkNHTj1zOTYtYyIsImdpdmVuX25hbWUiOiJBbnRob255IiwiZmFtaWx5X25hbWUiOiJUcmFuc2l0b3JlbnQiLCJsb2NhbGUiOiJlbiIsImlhdCI6MTcxOTU2NjA2MiwibmJmIjoxNzE5NTY2MDYyLCJqdGkiOiI2NzY1NzcwNjQyNTU2MzkxMTc5NDk0Mzg1NDI4OTY1MTEzMTQ1MTIiLCJjbGllbnRfaWQiOiI0MDc0MDg3MTgxMDMubGNzYXBwcy5nb29nbGUuY29tIiwic291cmNlIjoiYWNjb3VudHNfdWkiLCJ1c2VyX2lkIjoiMTE1ODU5NDc1NDQ5MjY2NzQ4NzY3In0.F94n0F8u_6-1120v-J7s_Q9i2Q6Rk9zP92tH09J7J76J0K0o7i3-v9q0t_9m0P0o0S0t_0r1T0w0J0V0u0z1I0x0q0U0q0L0o0j0N0Q0s0W0z0O0V0M0P0u0z1H0J0X0t0F0X0S0u0q0j0R0L0V0q0J0Q0M0O0P0s0t0N0W0z0J0X0F0S0u0V0M0P0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0H0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0H0t0J0X0F0S0V0M0P0u0r0q0U0i0W0O0j0L0N0Q0s0z0I0t0J0X0F0S0V0M0P elektroniczne.
| **1. Advanced Emotional Engine**        | `EmotionalPolicyEngine` (LLM-driven), `PersonalDiary` (rich logs).                                                  | Structured domain models (`EmotionalState`, `MoodVector`, `OpinionScore`) exist. Basic API-driven updates. No LLM policy engine or rich diary. | **Known & Deferred (V2 Focus: Domain Models).** Handoff V6 (Tasks 003-006, 010) prioritized model creation and basic re-enablement. Handoff V7 plans simpler callback-based emotion integration, not the full LLM policy engine. |
| **2. Comprehensive Memory System**      | Multi-layered memory (`Working`, `Short-term`, `Episodic`, `Semantic`, `Procedural`), `MemoryConsolidator`.              | `Minion.working_memory` field exists. Other layers and consolidator are absent.                                                              | **Known & Deferred (V2 Focus: Basic Functionality).** Handoff V6 (Task 011) planned basic re-enablement. Handoff V7 plans simpler callback-based memory context for prompts.                                       |
| **3. Specialized ADK Agent Types**      | `TaskMasterAgent` (SequentialWorkflowAgent), `ResearchScoutAgent`, etc.                                              | Only general `ADKMinionAgent` implemented.                                                                                                      | **Not in V2 Scope.** Handoffs do not mention specialized agents as part of the V2 recovery. Assumed post-V2.                                                                                                     |
| **4. Advanced Inter-Minion Comm.**    | Multi-modal system (Conversational, Structured Data, RPC), `AutonomousMessagingEngine`, `CommunicationSafeguards`.       | Event-driven chat via `GeminiEventBus`. Basic `send_channel_message` tool.                                                                        | **Partially Addressed (Basic Tools in V2).** Handoff V6 (Task 013) aims to complete basic communication tools. Advanced features are not in V2 scope.                                                                  |
| **5. Generalized MCP Toolbelt**         | `MCPToolbeltFramework`, dynamic tool discovery from MCP server, `MCPToADKAdapter`.                                       | `ADKCommunicationKit` with hardcoded, placeholder communication tools. No dynamic discovery or MCP adaptation.                                   | **Known & Deferred (V2 Focus: Basic Tool Functionality).** Handoff V6 (Tasks 007, 013) focuses on making basic ADK tools work. The generalized framework is not in V2 scope.                                               |
| **6. Scalable State Management**        | Distributed Cache (Redis), Document Store (MongoDB), Vector DB (Pinecone), etc.                                        | All persistence is in-memory (`ChannelRepositoryMemory`, `MinionRepositoryMemory`, etc.).                                                         | **Not in V2 Scope.** Handoffs do not prioritize scalable persistence for the V2 recovery effort.                                                                                                                             |
| **7. Production-Ready Error Handling**  | `ResilientMinionSystem` (Circuit Breakers, Retry Policies, Fallbacks).                                                 | Basic error logging.                                                                                                                            | **Partially in V2 Scope (Task 015).** Handoff V6 (Task 015 "Production Readiness") includes "proper error handling, retry logic." The full `ResilientMinionSystem` is likely beyond initial V2.                        |
| **8. Task Domain Full Integration**     | Fully integrated task management system as per layered architecture.                                               | Domain models (`Task.py`), repository (`TaskRepositoryMemory`), and frontend components exist. Backend service not fully integrated.                 | **Not in V2 Scope.** Handoffs do not detail tasks for full backend integration of the task service in V2.                                                                                                               |
| **9. Use Cases Layer**                  | `core/application/use_cases/` directory and distinct use case objects.                                                  | Use case logic is currently embedded within Application Services.                                                                               | **Minor Structural Deviation.** Not explicitly mentioned in handoffs; likely a refinement for later.                                                                                                                    |

## 5. ADK Integration Specifics

The status and correctness of ADK integration are critical, as highlighted by the handoff documents.

*   **`ADKMinionAgent` Implementation:**
    *   **Requirement:** Subclass `LlmAgent`, integrate domain data, use ADK tool mechanisms.
    *   **Current:** `ADKMinionAgent` **correctly subclasses `LlmAgent`**. It successfully stores minion-specific data (persona, etc.) as private instance attributes, resolving previous Pydantic validation errors (a key V2 fix detailed in handoffs). Instructions are dynamically built. Tools are passed via `ADKCommunicationKit`.
    *   **Assessment:** **Largely Correct and Aligned** for the agent class structure itself.

*   **ADK `Runner` Usage & Session Management:**
    *   **Requirement:** Leverage `Runner` for agent execution, session management, and integrating dynamic context (like emotional state) via `Session.state`.
    *   **Current:** `MinionServiceV2` creates a `Runner` per agent with an `InMemorySessionService`. It attempts to use `runner.predict()` for generating responses.
    *   **Handoff Context:** This is the **primary unresolved issue** of the V2 effort.
        *   `CRITICAL_HANDOFF_V7` states the main blocker is `"Session not found"` errors when `runner.predict()` (or `run_async()`) is called.
        *   The handoff emphasizes that the `Project_Context_Crucible.md` should be the guide for correct ADK patterns, including Runner and Session usage.
        *   The plan was to use `predict()` for simple chat and potentially `run_async()` for streaming. The current implementation uses `predict()`.
        *   The ideal architecture's use of `Session.state` for injecting dynamic context (mood, memory) into `predict()` calls is **not yet evident or functional**.
    *   **Assessment:** The setup of the Runner is structurally present. However, the interaction with `InMemorySessionService` and the `predict` method is **currently incorrect or incomplete**, leading to the "Session not found" errors and preventing minions from generating Gemini responses. This is the most critical deviation affecting core functionality.

*   **ADK Tools:**
    *   **Requirement:** ADK-native tools.
    *   **Current:** `ADKCommunicationKit` provides functions intended as tools. These are passed to `LlmAgent`.
    *   **Handoff Context:** Task 007 and 013 in Handoff V6 aimed to make these tools "proper ADK FunctionTools."
    *   **Assessment:** The mechanism of providing tools to the `LlmAgent` is **idiomatically correct at a basic level**. The tools themselves are placeholders, which is a content issue rather than an ADK integration pattern issue for now.

*   **ADK Callbacks & Advanced Integration:**
    *   **Requirement:** Use of callbacks for deeper integration (e.g., emotional/memory updates).
    *   **Current:** Not implemented.
    *   **Handoff Context:** Handoff V7 suggests using ADK callbacks for future emotional/memory integration.
    *   **Assessment:** **Not yet implemented.** This is a more advanced ADK feature, deferred until basic response generation is working.

**ADK Integration Conclusion:** The V2 effort successfully refactored the agent to correctly subclass `LlmAgent`. The immediate and critical problem is the runtime failure of `Runner.predict()` due to session management issues. The `Project_Context_Crucible.md` is identified as the key resource for resolving this. Deeper ADK integrations (callbacks, `Session.state` for dynamic context) are planned but not yet implemented.

## 6. Conclusion & Recommendations

The Gemini Legion codebase (V2) has made substantial progress in aligning with the foundational aspects of the `IDEAL_ARCHITECTURE_DESIGN_DOCUMENT.md`. The shift to a proper, event-driven architecture with correctly subclassed ADK agents is a significant achievement. The domain models for core concepts like Minions, Channels, and basic Emotional State are in place.

**Critical Areas Needing Immediate Attention:**

1.  **ADK Runner/Session Issue:** This is the highest priority. The "Session not found" error when using `Runner.predict()` must be resolved to enable actual AI response generation. A thorough review of `Project_Context_Crucible.md` and ADK documentation on `InMemorySessionService` and `Runner` interaction is paramount. Ensure sessions are correctly created, identified, and utilized by `predict()`.
2.  **Tool Implementation:** While the ADK registration is sound, the communication tools in `ADKCommunicationKit` are placeholders. For minions to interact meaningfully, these tools need to be implemented to actually perform their described actions (e.g., by emitting appropriate events or calling services).

**Secondary Areas for Development (Post-Blocker Resolution):**

1.  **Emotional Engine Integration:** Implement the callback-based integration for emotional state updates and dynamic prompt modification via `Session.state` as suggested in Handoff V7.
2.  **Memory System Integration:** Implement the callback-based integration for memory context in prompts, also suggested in Handoff V7.
3.  **Task Domain Integration:** Fully integrate the `TaskService` into the backend application flow.
4.  **Frontend Real-time Updates:** Complete the WebSocket event handling in `useWebSocket.ts` and ensure all relevant UI components update in real-time based on backend events.

**Long-Term Architectural Goals (Beyond Immediate V2 Stabilization):**

*   Implement the advanced features from the ideal architecture:
    *   LLM-driven Emotional Policy Engine and Personal Diaries.
    *   Comprehensive multi-layered Minion Memory System.
    *   Specialized ADK agent types.
    *   Advanced inter-minion communication modalities and safeguards.
    *   Generalized MCP Toolbelt Framework with dynamic tool discovery.
    *   Scalable state management (migrating from in-memory to distributed databases).
    *   `ResilientMinionSystem` for production-grade error handling.
*   Consider creating the distinct `use_cases` layer in the backend if complexity grows.

The current state is a promising, albeit incomplete, realization of the architectural vision. Resolving the ADK Runner issue will unlock the core functionality and pave the way for implementing the richer features that define the Gemini Legion concept.
