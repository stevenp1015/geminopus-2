# JULES - Task Tracker - 2025-07-08

This document tracks the bugs and features being addressed by Jules.

## Initial Bug List (from User Feedback after initial message display fix)

-   [ ] **Backend: `.env` file for API Key (User Verification)**
    -   Status: Backend code implemented. User to verify by creating `.env` and testing.
-   [x] **Backend: 422 Error on Sending Message (Private & Public)**
    -   Status: FIXED (Frontend `channelApi.ts` payload corrected to send `sender` and `channel_id` in body, matching `SendMessageRequest` schema).
-   [x] **Backend: System Messages in Private Channels**
    -   Status: FIXED (`ChannelServiceV2.send_message` allows `sender_id="system"` to bypass membership check).
-   [x] **Backend: Minions Responding in Incorrect Channels**
    *   Status: FIXED (`MinionServiceV2` now checks channel membership before responding).
-   [ ] **Frontend: Duplicate Messages (Root Cause)**
    *   Symptom: Messages sometimes appear twice in UI (though `chatStore.addMessage` idempotency helps).
    *   Notes: Need to trace if backend `WebSocketEventBridge` emits once per logical message, and if frontend `legionStore`'s `message_sent` handler calls `chatStore.handleNewMessage` once per actual WebSocket event.
-   [ ] **Frontend: Message History Accumulation/Bleeding When Switching Channels**
    *   Symptom: Selecting a new channel doesn't always clear old messages correctly, leading to a merged view.
-   [ ] **Frontend: New Channels Not Auto-Selected/Subscribed**
    *   Symptom: User needs to click a newly created channel to make it active and subscribe for messages.
-   [ ] **Frontend: Participants List Inaccurate**
    *   Symptom: List doesn't always reflect current channel members.
-   [ ] **Frontend: Commander Name Not Showing in Participants List**
-   [ ] **Frontend: "Text stays in input then clears" behavior review**
    *   Symptom: Input text clears only after backend response. (May be acceptable if messages now appear promptly).
-   [ ] **Frontend Feature: Add/Edit Minions from Participants List**

## Backend Startup Issues (Historical - Now Fixed)
-   [x] **Pydantic: `BaseSettings` Import Error**
    -   Status: FIXED (Changed import in `config/settings.py`).
-   [x] **Pydantic: `ValidationError` for Path fields in `Settings`**
    -   Status: FIXED (Used `Field(default=Path(...))` and `model_validator` in `config/settings.py`).
-   [x] **Pydantic: `AttributeError: 'Settings' object has no attribute 'get'`**
    -   Status: FIXED (Corrected `model_validator` signature in `config/settings.py`).
-   [x] **AttributeError: module 'settings' has no attribute 'GOOGLE_API_KEY'**
    -   Status: FIXED (Corrected import of `settings` instance in `dependencies_v2.py`).

## Current Focus / Next Steps:
1.  Diagnose and fix the root cause of potential duplicate `message_sent` event processing in the frontend (`legionStore.ts`).
2.  Fix message history bleeding between channels (`chatStore.ts` and `ChatInterface.tsx`).
3.  Implement auto-selection and subscription for newly created channels.

---
*Jules was here.*
